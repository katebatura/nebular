!function(){"use strict";function t(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(c){u=!0,o=c}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,n)||function(t,n){if(!t)return;if("string"==typeof t)return e(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return e(t,n)}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}(self.webpackChunknebular=self.webpackChunknebular||[]).push([[8733],{18733:function(e,r,i){i.r(r),i.d(r,{AuthPlaygroundModule:function(){return st},filterInterceptorRequest:function(){return ct}});var a,u=i(38583),c=i(3679),s=i(91841),l=i(32937),h=i(44265),f=i(10643),p=i(43190),d=i(15798),g=i(69207),v=i(37716),y=((a=function(){function t(e,r){n(this,t),this.injector=e,this.filter=r}return o(t,[{key:"intercept",value:function(t,e){var n=this;return this.filter(t)?e.handle(t):this.authService.isAuthenticatedOrRefresh().pipe((0,p.w)(function(r){return r?n.authService.getToken().pipe((0,p.w)(function(n){var r="Bearer ".concat(n.getValue());return t=t.clone({setHeaders:{Authorization:r}}),e.handle(t)})):e.handle(t)}))}},{key:"authService",get:function(){return this.injector.get(d._)}}]),t}()).\u0275fac=function(t){return new(t||a)(v.LFG(v.zs3),v.LFG(g.nN))},a.\u0275prov=v.Yz7({token:a,factory:a.\u0275fac}),a),b=i(68729),m=i(16721),w=i(67846),A=i(93264),k=i(9814),Z=i(97501),R=function t(){n(this,t)},C=new v.OlP("Nebular Security Options"),S=function(t){return Object.assign({},t)},T=function(t){return Object.assign([],t)},q=function(t){var e=t.parent;return delete t.parent,e},O=function(){var e=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),this.settings=t,this.state={},t.accessControl&&this.setAccessControl(t.accessControl)}return o(e,[{key:"setAccessControl",value:function(e){for(var n=0,r=Object.entries(e);n<r.length;n++){var o=t(r[n],2),i=o[0],a=o[1],u=S(a),c=q(u);this.register(i,c,u)}}},{key:"register",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.validateRole(e),this.state[e]={parent:n};for(var o=0,i=Object.entries(r);o<i.length;o++){var a=t(i[o],2),u=a[0],c=a[1];this.allow(e,u,T("string"==typeof c?[c]:c))}}},{key:"allow",value:function(t,e,n){this.validateRole(t),this.getRole(t)||this.register(t,null,{}),n="string"==typeof n?[n]:n;var r=T(this.getRoleResources(t,e));r=r.concat(n),this.state[t][e]=r.filter(function(t,e){return r.indexOf(t)===e})}},{key:"can",value:function(t,e,n){return this.validateResource(n),this.getRoleParent(t)&&this.can(this.getRoleParent(t),e,n)||this.exactCan(t,e,n)}},{key:"getRole",value:function(t){return this.state[t]}},{key:"validateRole",value:function(t){if(!t)throw new Error("NbAclService: role name cannot be empty")}},{key:"validateResource",value:function(t){if(!t||[e.ANY_RESOURCE].includes(t))throw new Error("NbAclService: cannot use empty or bulk '*' resource placeholder with 'can' method")}},{key:"exactCan",value:function(t,n,r){var o=this.getRoleResources(t,n);return o.includes(r)||o.includes(e.ANY_RESOURCE)}},{key:"getRoleResources",value:function(t,e){return this.getRoleAbilities(t)[e]||[]}},{key:"getRoleAbilities",value:function(t){var e=S(this.state[t]||{});return q(S(this.state[t]||{})),e}},{key:"getRoleParent",value:function(t){return this.state[t]?this.state[t].parent:null}}]),e}();return e.ANY_RESOURCE="*",e.\u0275fac=function(t){return new(t||e)(v.LFG(C,8))},e.\u0275prov=v.Yz7({token:e,factory:e.\u0275fac}),e}(),Y=i(88002),_=function(){var t=function(){function t(e,r){n(this,t),this.roleProvider=e,this.acl=r}return o(t,[{key:"isGranted",value:function(t,e){var n=this;return this.roleProvider.getRole().pipe((0,Y.U)(function(t){return Array.isArray(t)?t:[t]}),(0,Y.U)(function(r){return r.some(function(r){return n.acl.can(r,t,e)})}))}}]),t}();return t.\u0275fac=function(e){return new(e||t)(v.LFG(R),v.LFG(O))},t.\u0275prov=v.Yz7({token:t,factory:t.\u0275fac}),t}(),U=function(){var t=function(){function t(){n(this,t)}return o(t,null,[{key:"forRoot",value:function(e){return{ngModule:t,providers:[{provide:C,useValue:e},O,_]}}}]),t}();return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=v.oAB({type:t}),t.\u0275inj=v.cJS({imports:[[u.ez]]}),t}(),G=i(10494),P=function(){var t=function t(){n(this,t)};return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=v.Xpm({type:t,selectors:[["nb-playground-auth"]],decls:1,vars:0,template:function(t,e){1&t&&v._UZ(0,"router-outlet")},directives:[G.lC],encapsulation:2}),t}(),F=i(86239),I=i(58717),N=i(6817),E=i(13167),j=i(62878),V=i(64959),z=i(40646),x=i(74743),L=i(46782),J=i(79765),B=function(){var e=function(){function e(t,r,o){n(this,e),this.templateRef=t,this.viewContainer=r,this.accessChecker=o,this.destroy$=new J.xQ,this.hasView=!1}return o(e,[{key:"nbIsGranted",set:function(e){var n=this,r=t(e,2),o=r[0],i=r[1];this.accessChecker.isGranted(o,i).pipe((0,L.R)(this.destroy$)).subscribe(function(t){t&&!n.hasView?(n.viewContainer.createEmbeddedView(n.templateRef),n.hasView=!0):!t&&n.hasView&&(n.viewContainer.clear(),n.hasView=!1)})}},{key:"ngOnDestroy",value:function(){this.destroy$.next(),this.destroy$.complete()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(v.Rgc),v.Y36(v.s_b),v.Y36(_))},e.\u0275dir=v.lG2({type:e,selectors:[["","nbIsGranted",""]],inputs:{nbIsGranted:"nbIsGranted"}}),e}();function D(t,e){1&t&&(v.TgZ(0,"button"),v._uU(1,"Post Comment"),v.qZA())}function $(t,e){1&t&&(v.TgZ(0,"button"),v._uU(1,"Post Comment"),v.qZA())}var M=function(){return["create","comments"]},Q=function(){var t=function t(e){n(this,t),this.accessChecker=e};return t.\u0275fac=function(e){return new(e||t)(v.Y36(_))},t.\u0275cmp=v.Xpm({type:t,selectors:[["nb-actions-test"]],decls:13,vars:5,consts:[[4,"ngIf"],[4,"nbIsGranted"]],template:function(t,e){1&t&&(v.TgZ(0,"nb-layout"),v.TgZ(1,"nb-layout-column"),v.TgZ(2,"nb-card"),v.TgZ(3,"nb-card-header"),v._uU(4,"Service usage"),v.qZA(),v.TgZ(5,"nb-card-body"),v.YNc(6,D,2,0,"button",0),v.ALo(7,"async"),v.qZA(),v.qZA(),v.TgZ(8,"nb-card"),v.TgZ(9,"nb-card-header"),v._uU(10,"Directive usage"),v.qZA(),v.TgZ(11,"nb-card-body"),v.YNc(12,$,2,0,"button",1),v.qZA(),v.qZA(),v.qZA(),v.qZA()),2&t&&(v.xp6(6),v.Q6J("ngIf",v.lcZ(7,2,e.accessChecker.isGranted("create","comments"))),v.xp6(6),v.Q6J("nbIsGranted",v.DdM(4,M)))},directives:[z.Aq,z.dP,x.As,x.nd,x.yK,u.O5,B],pipes:[u.Ov],encapsulation:2}),t}(),K=i(93342),H=function(){var t=function(){function t(e,r){n(this,t),this.authService=e,this.router=r}return o(t,[{key:"canActivate",value:function(){var t=this;return this.authService.isAuthenticated().pipe((0,K.b)(function(e){e||t.router.navigate(["auth/login"])}))}}]),t}();return t.\u0275fac=function(e){return new(e||t)(v.LFG(d._),v.LFG(G.F0))},t.\u0275prov=v.Yz7({token:t,factory:t.\u0275fac}),t}(),W=i(25917),X=i(71289),tt=i(5304),et=i(47852),nt=i(59190);function rt(t,e){if(1&t&&(v.TgZ(0,"nb-list-item"),v._uU(1),v.qZA()),2&t){var n=e.$implicit;v.xp6(1),v.lnq(" ",n.region,", ",n.name," (",n.year,") ")}}function ot(t,e){if(1&t&&(v.TgZ(0,"nb-card"),v.TgZ(1,"nb-card-header"),v._uU(2," Alain'wines "),v.qZA(),v.TgZ(3,"nb-list"),v.YNc(4,rt,2,3,"nb-list-item",2),v.ALo(5,"async"),v.qZA(),v.qZA()),2&t){var n=v.oxw();v.xp6(4),v.Q6J("ngForOf",v.lcZ(5,1,n.wines$))}}var it=[{path:"",component:P,children:[{path:"",component:F.A,children:[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:I.Y},{path:"register",component:N.e},{path:"logout",component:E.f},{path:"request-password",component:j.C},{path:"reset-password",component:V.j}]}]},{path:"acl/acl-test.component",component:Q},{path:"auth-guard.service",canActivate:[H],component:P},{path:"api-calls.component",canActivate:[H],component:function(){var t=function(){function t(e,r,o){var i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};n(this,t),this.authService=e,this.http=r,this.router=o,this.options=a,this.redirectDelay=0,this.strategy="",this.redirectDelay=this.getConfigValue("forms.logout.redirectDelay"),this.strategy=this.getConfigValue("forms.logout.strategy"),this.authService.onTokenChange().subscribe(function(t){i.token=null,t&&t.isValid()&&(i.token=t)})}return o(t,[{key:"logout",value:function(){var t=this;this.authService.logout(this.strategy).pipe((0,X.g)(this.redirectDelay)).subscribe(function(e){return t.router.navigate(["/auth/login"])})}},{key:"loadWines",value:function(){var t=this;this.wines$=this.http.get("http://localhost:4400/api/wines").pipe((0,tt.K)(function(e){return e instanceof s.UA&&401===e.status&&t.router.navigate(["/auth/login"]),(0,W.of)([])}))}},{key:"getConfigValue",value:function(t){return(0,et.hB)(this.options,t,null)}}]),t}();return t.\u0275fac=function(e){return new(e||t)(v.Y36(d._),v.Y36(s.eN),v.Y36(G.F0),v.Y36(g.h))},t.\u0275cmp=v.Xpm({type:t,selectors:[["nb-playground-api-calls"]],decls:15,vars:3,consts:[["nbButton","","status","primary",3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(t,e){var n;(1&t&&(v._UZ(0,"router-outlet"),v.TgZ(1,"nb-layout"),v.TgZ(2,"nb-layout-column"),v.TgZ(3,"nb-card"),v.TgZ(4,"nb-card-body"),v.TgZ(5,"h2"),v._uU(6,"You are authenticated"),v.qZA(),v.TgZ(7,"p"),v._uU(8,"You can call the secured API"),v.qZA(),v.TgZ(9,"button",0),v.NdJ("click",function(){return e.loadWines()}),v._uU(10,"Call API"),v.qZA(),v.TgZ(11,"button",0),v.NdJ("click",function(){return e.logout()}),v._uU(12,"Sign out"),v.qZA(),v.qZA(),v.qZA(),v.YNc(13,ot,6,3,"nb-card",1),v.ALo(14,"async"),v.qZA(),v.qZA()),2&t)&&(v.xp6(13),v.Q6J("ngIf",null==(n=v.lcZ(14,1,e.wines$))?null:n.length))},directives:[G.lC,z.Aq,z.dP,x.As,x.yK,u.O5,x.nd,nt.z,u.sg,nt.q],pipes:[u.Ov],encapsulation:2}),t}()}],at=function(){var t=function t(){n(this,t)};return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=v.oAB({type:t}),t.\u0275inj=v.cJS({imports:[[G.Bz.forChild(it)],G.Bz]}),t}(),ut=function(){var t=function(){function t(e){n(this,t),this.authService=e}return o(t,[{key:"getRole",value:function(){return this.authService.onTokenChange().pipe((0,Y.U)(function(t){return t instanceof A.OS&&t.isValid()?t.getPayload().role:"guest"}))}}]),t}();return t.\u0275fac=function(e){return new(e||t)(v.LFG(d._))},t.\u0275prov=v.Yz7({token:t,factory:t.\u0275fac}),t}();function ct(t){return["http://localhost:4400/api/auth/","http://other.url/with/no/token/injected/"].some(function(e){return t.url.includes(e)})}var st=function(){var t=function t(){n(this,t)};return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=v.oAB({type:t}),t.\u0275inj=v.cJS({providers:[H,{provide:s.TP,useClass:y,multi:!0},{provide:g.nN,useValue:ct},{provide:R,useClass:ut}],imports:[[u.ez,c.u5,s.JF,at,l.z,h.B,f.C,b.S.forRoot({forms:{login:{strategy:"password",redirectDelay:1e3,socialLinks:[{url:"https://github.com/akveo",target:"_blank",title:"GitHub"},{url:"https://www.facebook.com/akveo",target:"_blank",icon:"home-outline"},{url:"https://www.facebook.com/akveo",target:"_blank",title:"Twitter"}]}},strategies:[m.r.setup({name:"dummy",alwaysFail:!0,delay:1e3}),w.O.setup({name:"email",token:{class:A.OS},baseEndpoint:"http://localhost:4400/api/auth/",logout:{redirect:{success:"/auth/login",failure:"/auth/login"}},requestPass:{redirect:{success:"/auth/reset-password"}},resetPass:{redirect:{success:"/auth/login"}},errors:{key:"data.errors"}}),k.F.setup({name:"password",clientId:"test",clientSecret:"secret",baseEndpoint:"http://localhost:4400/api/auth/",token:{endpoint:"token",grantType:Z.sY.PASSWORD,class:A.FN},refresh:{endpoint:"refresh-token",grantType:Z.sY.REFRESH_TOKEN}})]}),U.forRoot({accessControl:{guest:{view:["news","comments"]},user:{parent:"guest",create:"comments"},moderator:{parent:"user",create:"news",remove:"*"}}})]]}),t}()}}])}();