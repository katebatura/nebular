"use strict";(self.webpackChunknebular=self.webpackChunknebular||[]).push([[8733],{18733:function(t,e,n){n.r(e),n.d(e,{AuthPlaygroundModule:function(){return ot},filterInterceptorRequest:function(){return st}});var r=n(38583),s=n(3679),o=n(91841),a=n(32937),i=n(44265),c=n(10643),u=n(43190),l=n(15798),h=n(69207),p=n(37716);let d=(()=>{class t{constructor(t,e){this.injector=t,this.filter=e}intercept(t,e){return this.filter(t)?e.handle(t):this.authService.isAuthenticatedOrRefresh().pipe((0,u.w)(n=>n?this.authService.getToken().pipe((0,u.w)(n=>{const r=`Bearer ${n.getValue()}`;return t=t.clone({setHeaders:{Authorization:r}}),e.handle(t)})):e.handle(t)))}get authService(){return this.injector.get(l._)}}return t.\u0275fac=function(e){return new(e||t)(p.LFG(p.zs3),p.LFG(h.nN))},t.\u0275prov=p.Yz7({token:t,factory:t.\u0275fac}),t})();var g=n(68729),f=n(16721),m=n(67846),b=n(93264),v=n(9814),y=n(97501);class w{}const A=new p.OlP("Nebular Security Options"),Z=t=>Object.assign({},t),R=t=>Object.assign([],t),k=t=>{const e=t.parent;return delete t.parent,e};let C=(()=>{class t{constructor(t={}){this.settings=t,this.state={},t.accessControl&&this.setAccessControl(t.accessControl)}setAccessControl(t){for(const[e,n]of Object.entries(t)){const t=Z(n),r=k(t);this.register(e,r,t)}}register(t,e=null,n={}){this.validateRole(t),this.state[t]={parent:e};for(const[r,s]of Object.entries(n))this.allow(t,r,R("string"==typeof s?[s]:s))}allow(t,e,n){this.validateRole(t),this.getRole(t)||this.register(t,null,{}),n="string"==typeof n?[n]:n;let r=R(this.getRoleResources(t,e));r=r.concat(n),this.state[t][e]=r.filter((t,e)=>r.indexOf(t)===e)}can(t,e,n){return this.validateResource(n),this.getRoleParent(t)&&this.can(this.getRoleParent(t),e,n)||this.exactCan(t,e,n)}getRole(t){return this.state[t]}validateRole(t){if(!t)throw new Error("NbAclService: role name cannot be empty")}validateResource(e){if(!e||[t.ANY_RESOURCE].includes(e))throw new Error("NbAclService: cannot use empty or bulk '*' resource placeholder with 'can' method")}exactCan(e,n,r){const s=this.getRoleResources(e,n);return s.includes(r)||s.includes(t.ANY_RESOURCE)}getRoleResources(t,e){return this.getRoleAbilities(t)[e]||[]}getRoleAbilities(t){const e=Z(this.state[t]||{});return k(Z(this.state[t]||{})),e}getRoleParent(t){return this.state[t]?this.state[t].parent:null}}return t.ANY_RESOURCE="*",t.\u0275fac=function(e){return new(e||t)(p.LFG(A,8))},t.\u0275prov=p.Yz7({token:t,factory:t.\u0275fac}),t})();var T=n(88002);let q=(()=>{class t{constructor(t,e){this.roleProvider=t,this.acl=e}isGranted(t,e){return this.roleProvider.getRole().pipe((0,T.U)(t=>Array.isArray(t)?t:[t]),(0,T.U)(n=>n.some(n=>this.acl.can(n,t,e))))}}return t.\u0275fac=function(e){return new(e||t)(p.LFG(w),p.LFG(C))},t.\u0275prov=p.Yz7({token:t,factory:t.\u0275fac}),t})(),S=(()=>{class t{static forRoot(e){return{ngModule:t,providers:[{provide:A,useValue:e},C,q]}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=p.oAB({type:t}),t.\u0275inj=p.cJS({imports:[[r.ez]]}),t})();var Y=n(10494);let _=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Xpm({type:t,selectors:[["nb-playground-auth"]],decls:1,vars:0,template:function(t,e){1&t&&p._UZ(0,"router-outlet")},directives:[Y.lC],encapsulation:2}),t})();var O=n(86239),G=n(58717),U=n(6817),F=n(13167),P=n(62878),N=n(64959),E=n(40646),I=n(74743),V=n(46782),z=n(79765);let L=(()=>{class t{constructor(t,e,n){this.templateRef=t,this.viewContainer=e,this.accessChecker=n,this.destroy$=new z.xQ,this.hasView=!1}set nbIsGranted([t,e]){this.accessChecker.isGranted(t,e).pipe((0,V.R)(this.destroy$)).subscribe(t=>{t&&!this.hasView?(this.viewContainer.createEmbeddedView(this.templateRef),this.hasView=!0):!t&&this.hasView&&(this.viewContainer.clear(),this.hasView=!1)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(p.Rgc),p.Y36(p.s_b),p.Y36(q))},t.\u0275dir=p.lG2({type:t,selectors:[["","nbIsGranted",""]],inputs:{nbIsGranted:"nbIsGranted"}}),t})();function j(t,e){1&t&&(p.TgZ(0,"button"),p._uU(1,"Post Comment"),p.qZA())}function x(t,e){1&t&&(p.TgZ(0,"button"),p._uU(1,"Post Comment"),p.qZA())}const J=function(){return["create","comments"]};let B=(()=>{class t{constructor(t){this.accessChecker=t}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(q))},t.\u0275cmp=p.Xpm({type:t,selectors:[["nb-actions-test"]],decls:13,vars:5,consts:[[4,"ngIf"],[4,"nbIsGranted"]],template:function(t,e){1&t&&(p.TgZ(0,"nb-layout"),p.TgZ(1,"nb-layout-column"),p.TgZ(2,"nb-card"),p.TgZ(3,"nb-card-header"),p._uU(4,"Service usage"),p.qZA(),p.TgZ(5,"nb-card-body"),p.YNc(6,j,2,0,"button",0),p.ALo(7,"async"),p.qZA(),p.qZA(),p.TgZ(8,"nb-card"),p.TgZ(9,"nb-card-header"),p._uU(10,"Directive usage"),p.qZA(),p.TgZ(11,"nb-card-body"),p.YNc(12,x,2,0,"button",1),p.qZA(),p.qZA(),p.qZA(),p.qZA()),2&t&&(p.xp6(6),p.Q6J("ngIf",p.lcZ(7,2,e.accessChecker.isGranted("create","comments"))),p.xp6(6),p.Q6J("nbIsGranted",p.DdM(4,J)))},directives:[E.Aq,E.dP,I.As,I.nd,I.yK,r.O5,L],pipes:[r.Ov],encapsulation:2}),t})();var D=n(93342);let $=(()=>{class t{constructor(t,e){this.authService=t,this.router=e}canActivate(){return this.authService.isAuthenticated().pipe((0,D.b)(t=>{t||this.router.navigate(["auth/login"])}))}}return t.\u0275fac=function(e){return new(e||t)(p.LFG(l._),p.LFG(Y.F0))},t.\u0275prov=p.Yz7({token:t,factory:t.\u0275fac}),t})();var Q=n(25917),K=n(71289),M=n(5304),H=n(47852),W=n(59190);function X(t,e){if(1&t&&(p.TgZ(0,"nb-list-item"),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.lnq(" ",t.region,", ",t.name," (",t.year,") ")}}function tt(t,e){if(1&t&&(p.TgZ(0,"nb-card"),p.TgZ(1,"nb-card-header"),p._uU(2," Alain'wines "),p.qZA(),p.TgZ(3,"nb-list"),p.YNc(4,X,2,3,"nb-list-item",2),p.ALo(5,"async"),p.qZA(),p.qZA()),2&t){const t=p.oxw();p.xp6(4),p.Q6J("ngForOf",p.lcZ(5,1,t.wines$))}}const et=[{path:"",component:_,children:[{path:"",component:O.A,children:[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:G.Y},{path:"register",component:U.e},{path:"logout",component:F.f},{path:"request-password",component:P.C},{path:"reset-password",component:N.j}]}]},{path:"acl/acl-test.component",component:B},{path:"auth-guard.service",canActivate:[$],component:_},{path:"api-calls.component",canActivate:[$],component:(()=>{class t{constructor(t,e,n,r={}){this.authService=t,this.http=e,this.router=n,this.options=r,this.redirectDelay=0,this.strategy="",this.redirectDelay=this.getConfigValue("forms.logout.redirectDelay"),this.strategy=this.getConfigValue("forms.logout.strategy"),this.authService.onTokenChange().subscribe(t=>{this.token=null,t&&t.isValid()&&(this.token=t)})}logout(){this.authService.logout(this.strategy).pipe((0,K.g)(this.redirectDelay)).subscribe(t=>this.router.navigate(["/auth/login"]))}loadWines(){this.wines$=this.http.get("http://localhost:4400/api/wines").pipe((0,M.K)(t=>(t instanceof o.UA&&401===t.status&&this.router.navigate(["/auth/login"]),(0,Q.of)([]))))}getConfigValue(t){return(0,H.hB)(this.options,t,null)}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(l._),p.Y36(o.eN),p.Y36(Y.F0),p.Y36(h.h))},t.\u0275cmp=p.Xpm({type:t,selectors:[["nb-playground-api-calls"]],decls:15,vars:3,consts:[["nbButton","","status","primary",3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(t,e){if(1&t&&(p._UZ(0,"router-outlet"),p.TgZ(1,"nb-layout"),p.TgZ(2,"nb-layout-column"),p.TgZ(3,"nb-card"),p.TgZ(4,"nb-card-body"),p.TgZ(5,"h2"),p._uU(6,"You are authenticated"),p.qZA(),p.TgZ(7,"p"),p._uU(8,"You can call the secured API"),p.qZA(),p.TgZ(9,"button",0),p.NdJ("click",function(){return e.loadWines()}),p._uU(10,"Call API"),p.qZA(),p.TgZ(11,"button",0),p.NdJ("click",function(){return e.logout()}),p._uU(12,"Sign out"),p.qZA(),p.qZA(),p.qZA(),p.YNc(13,tt,6,3,"nb-card",1),p.ALo(14,"async"),p.qZA(),p.qZA()),2&t){let t;p.xp6(13),p.Q6J("ngIf",null==(t=p.lcZ(14,1,e.wines$))?null:t.length)}},directives:[Y.lC,E.Aq,E.dP,I.As,I.yK,r.O5,I.nd,W.z,r.sg,W.q],pipes:[r.Ov],encapsulation:2}),t})()}];let nt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=p.oAB({type:t}),t.\u0275inj=p.cJS({imports:[[Y.Bz.forChild(et)],Y.Bz]}),t})(),rt=(()=>{class t{constructor(t){this.authService=t}getRole(){return this.authService.onTokenChange().pipe((0,T.U)(t=>t instanceof b.OS&&t.isValid()?t.getPayload().role:"guest"))}}return t.\u0275fac=function(e){return new(e||t)(p.LFG(l._))},t.\u0275prov=p.Yz7({token:t,factory:t.\u0275fac}),t})();function st(t){return["http://localhost:4400/api/auth/","http://other.url/with/no/token/injected/"].some(e=>t.url.includes(e))}let ot=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=p.oAB({type:t}),t.\u0275inj=p.cJS({providers:[$,{provide:o.TP,useClass:d,multi:!0},{provide:h.nN,useValue:st},{provide:w,useClass:rt}],imports:[[r.ez,s.u5,o.JF,nt,a.z,i.B,c.C,g.S.forRoot({forms:{login:{strategy:"password",redirectDelay:1e3,socialLinks:[{url:"https://github.com/akveo",target:"_blank",title:"GitHub"},{url:"https://www.facebook.com/akveo",target:"_blank",icon:"home-outline"},{url:"https://www.facebook.com/akveo",target:"_blank",title:"Twitter"}]}},strategies:[f.r.setup({name:"dummy",alwaysFail:!0,delay:1e3}),m.O.setup({name:"email",token:{class:b.OS},baseEndpoint:"http://localhost:4400/api/auth/",logout:{redirect:{success:"/auth/login",failure:"/auth/login"}},requestPass:{redirect:{success:"/auth/reset-password"}},resetPass:{redirect:{success:"/auth/login"}},errors:{key:"data.errors"}}),v.F.setup({name:"password",clientId:"test",clientSecret:"secret",baseEndpoint:"http://localhost:4400/api/auth/",token:{endpoint:"token",grantType:y.sY.PASSWORD,class:b.FN},refresh:{endpoint:"refresh-token",grantType:y.sY.REFRESH_TOKEN}})]}),S.forRoot({accessControl:{guest:{view:["news","comments"]},user:{parent:"guest",create:"comments"},moderator:{parent:"user",create:"news",remove:"*"}}})]]}),t})()}}]);